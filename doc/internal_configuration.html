<html>
<head>
    <title>Advanced Configuration</title>
    <link href="media/css/documentation.css" type="text/css" rel="stylesheet" />
</head>

<body>
    
    
    <h1>Advanced Configuration</h1>
    
    <div class="section" id="introduction">
<h1>Introduction</h1>
<p>Cherokee's configuration system is based on an internal text file
format that the average user should not know about. This configuration
file is read by the server and modified by the administration
interface, so unless you are a Cherokee developer or a really
advanced user, the following format description will not be very
interesting to you.</p>
<p>Having said that, let's proceed to describe the configuration file format. It
is basically a text file that contains a tree where final nodes
contain values. Let's see a basic example:</p>
<pre class="literal-block">
server!port = 80
server!keepalive = 1
</pre>
<p>Most of the modules and plug-ins read a piece of the tree to
configure themselves. It provides extremely flexible configuration
capabilities for the price of a fairly complex text file. However, I
would like to point out again that users should never read of modify the
configuration file by hand, so it is a format that only developers
should know about.</p>
<p>The following blocks will summarize the configuration keys that
Cherokee 0.6 handles:</p>
</div>
<div class="section" id="server">
<h1>Server</h1>
<p>The server configuration keys define some of the server-wide
properties, such as the user under which the server ought to run if it
is run as root or whether to use keep-alive connections.</p>
<table class="docutils">
<colgroup>
<col width="37%" />
<col width="9%" />
<col width="54%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Key</strong></td>
<td><strong>Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr><td>server!port</td>
<td>Number</td>
<td>TCP port for HTTP</td>
</tr>
<tr><td>server!port_tls</td>
<td>Number</td>
<td>TCP port for HTTPS</td>
</tr>
<tr><td>server!max_fds</td>
<td>Number</td>
<td>Max open file descriptors</td>
</tr>
<tr><td>server!listen_queue</td>
<td>Number</td>
<td>Length of the listen queue</td>
</tr>
<tr><td>server!thread_number</td>
<td>Number</td>
<td>Number of threads</td>
</tr>
<tr><td>server!sendfile_min</td>
<td>Number</td>
<td>Minimum file size of using sendfile</td>
</tr>
<tr><td>server!sendfile_max</td>
<td>Number</td>
<td>Maximum file size of using sendfile</td>
</tr>
<tr><td>server!max_connection_reuse</td>
<td>Number</td>
<td>How many connections to reuse</td>
</tr>
<tr><td>server!ipv6</td>
<td>Bool</td>
<td>Whether to use IPv6</td>
</tr>
<tr><td>server!timeout</td>
<td>Number</td>
<td>Connections timeout</td>
</tr>
<tr><td>server!log_flush_elapse</td>
<td>Number</td>
<td>Time between log flushes</td>
</tr>
<tr><td>server!keepalive</td>
<td>Bool</td>
<td>Allow keepalive connections</td>
</tr>
<tr><td>server!keepalive_max_requests</td>
<td>Number</td>
<td>How many keepalive reqs per connection</td>
</tr>
<tr><td>server!unix_socket</td>
<td>Path</td>
<td>Listen to a Unix socket</td>
</tr>
<tr><td>server!panic_action</td>
<td>Path</td>
<td>Path to cherokee-panic</td>
</tr>
<tr><td>server!chroot</td>
<td>Bool</td>
<td>Whether to use chroot</td>
</tr>
<tr><td>server!pid_file</td>
<td>Path</td>
<td>PID file</td>
</tr>
<tr><td>server!mime_files</td>
<td>List</td>
<td>Path list to mime type files</td>
</tr>
<tr><td>server!listen</td>
<td>IP</td>
<td>Listen NIC</td>
</tr>
<tr><td>server!poll_method</td>
<td>String</td>
<td>Which poll method it should use</td>
</tr>
<tr><td>server!server_tokens</td>
<td>String</td>
<td>Server identification: minor, minimal, os, full</td>
</tr>
<tr><td>server!thread_policy</td>
<td>String</td>
<td>Thread policy: fifo, rr, other</td>
</tr>
<tr><td>server!user</td>
<td>String/
Number</td>
<td>Change effective user</td>
</tr>
<tr><td>server!group</td>
<td>String/
Number</td>
<td>Change effective group</td>
</tr>
<tr><td>server!module_dir</td>
<td>Path</td>
<td>Path to the plug-in directory</td>
</tr>
<tr><td>server!module_deps</td>
<td>Path</td>
<td>Path to the plug-in inter-dependencies files</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">server!server_tokens</span></tt> parameters</p>
<table class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Product</td>
<td>Cherokee</td>
</tr>
<tr><td>Minor</td>
<td>Cherokee/0.0</td>
</tr>
<tr><td>Minimal</td>
<td>Cherokee/0.0.0</td>
</tr>
<tr><td>OS</td>
<td>Cherokee/0.0.0 (UNIX)</td>
</tr>
<tr><td>Full</td>
<td>Cherokee/0.0.0 (UNIX) Ext/0.0 Ext2/0.0</td>
</tr>
</tbody>
</table>
<p><tt class="docutils literal"><span class="pre">server!thread_policy</span></tt> parameters</p>
<table class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>fifo</td>
<td>First in first out</td>
</tr>
<tr><td>rr</td>
<td>Round Robin</td>
</tr>
<tr><td>other</td>
<td>By default in Linux</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="server-encoders">
<h1>Server Encoders</h1>
<p>The <tt class="docutils literal"><span class="pre">server!encoder</span></tt> configuration branch allows to configure encode
plug-ins. Each entry accepts a number of options:</p>
<table class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>type</td>
<td>Set the matching policy: deny_allow or allow_deny</td>
</tr>
<tr><td>allow</td>
<td>List of extensions to encode</td>
</tr>
<tr><td>deny</td>
<td>List of extensions that shouldn't be encoded</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<pre class="literal-block">
server!encoder!gzip!allow = html,htm
server!encoder!gzip!deny  = jpg,png,gz
</pre>
</div>
<div class="section" id="virtual-server">
<h1>Virtual Server</h1>
<p>A virtual server contains the information related to one or more
domains under the same configuration. In a Cherokee server there must
be at least one virtual server named <tt class="docutils literal"><span class="pre">default</span></tt>, and there is no
maximum number.</p>
<p>The prefix of this type of entry is <tt class="docutils literal"><span class="pre">vserver</span></tt>, and by far, it is the
most common type of entry.</p>
<table class="docutils">
<colgroup>
<col width="47%" />
<col width="9%" />
<col width="44%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Key</strong></td>
<td><strong>Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr><td>vserver!default!document_root</td>
<td>Path</td>
<td>Document Root path</td>
</tr>
<tr><td>vserver!default!user_dir</td>
<td>String</td>
<td>User's web directory (for ~ requests)</td>
</tr>
<tr><td>vserver!default!domain! <tt class="docutils literal"><span class="pre">id</span></tt></td>
<td>String</td>
<td>Domain name, admits wildcards</td>
</tr>
<tr><td>vserver!default!error_handler</td>
<td>String</td>
<td>Defines the error handler module</td>
</tr>
<tr><td>vserver!default!directory_index</td>
<td>List</td>
<td>String list: Directory indexes</td>
</tr>
<tr><td>vserver!default!ssl_certificate_file</td>
<td>Path</td>
<td>TLS/SSL certificate file</td>
</tr>
<tr><td>vserver!default!ssl_certificate_key_file</td>
<td>Path</td>
<td>TLS/SSL certificate key file</td>
</tr>
<tr><td>vserver!default!ssl_ca_list_file</td>
<td>Path</td>
<td>TLS/SSL CA list file</td>
</tr>
</tbody>
</table>
<p>Besides these configuration keys there are a few other more complex
that needs further explanation:</p>
</div>
<div class="section" id="directories-requests-and-regular-expressions">
<h1>Directories, Requests and Regular Expressions</h1>
<p>These entries are located inside Virtual Servers. They basically
specify the behavior of the web server by setting up how to handle each
request based on the requested object and parameters.</p>
<p>There are three kinds of entry. All three of them admit
the same parameters, and depending on each case, the entry is followed
by the directory name, the extension list or the regular expression:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Directory:</th><td class="field-body"><p class="first">The directory specifies how to handle its contents.</p>
<p>Example: the root directory of the default virtual host would be represented by</p>
<p><tt class="docutils literal"><span class="pre">vserver!default!directory!/</span></tt></p>
</td>
</tr>
<tr class="field"><th class="field-name">Extension:</th><td class="field-body"><p class="first">It specifies a list of extensions and how they should be handled.</p>
<p>Eg: the JPG extensions is</p>
<p><tt class="docutils literal"><span class="pre">vserver!default!extensions!jpg,jpeg</span></tt></p>
</td>
</tr>
<tr class="field"><th class="field-name">Requests:</th><td class="field-body"><p class="first">When a request matches a regular expression entry, it uses its configuration.</p>
<p>Eg: requests beginning with 'a' and PHP extension</p>
<p class="last"><tt class="docutils literal"><span class="pre">vserver!default!request!^a.*\.php$</span></tt></p>
</td>
</tr>
</tbody>
</table>
<p>The following parameters are concatenated with any of the previous
kinds of entry:</p>
<table class="docutils">
<colgroup>
<col width="42%" />
<col width="8%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Key</strong></td>
<td><strong>Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr><td>priority</td>
<td>Number</td>
<td>Priority in the rules list</td>
</tr>
<tr><td>directory_root</td>
<td>Path</td>
<td>Special Directory Root for the request</td>
</tr>
<tr><td>allow_from</td>
<td>List</td>
<td>List of IP/Domain allowed to access the resource</td>
</tr>
<tr><td>handler</td>
<td>String</td>
<td>Handler (module) that handles the request</td>
</tr>
<tr><td>auth</td>
<td>String</td>
<td>Validator (module) that protects the resource</td>
</tr>
<tr><td>only_secure</td>
<td>Bool</td>
<td>Allow only secure (https) connections</td>
</tr>
</tbody>
</table>
<p>The <tt class="docutils literal"><span class="pre">auth</span></tt> entry deserves a little more attention, actually. It
restricts the access to some of the objects accessed by the web
server based on a number of properties that are defined at its child
properties:</p>
<table class="docutils">
<colgroup>
<col width="47%" />
<col width="9%" />
<col width="44%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Key</strong></td>
<td><strong>Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr><td>auth!methods</td>
<td>List</td>
<td>Allowed methods (basic, digest)</td>
</tr>
<tr><td>auth!realm</td>
<td>String</td>
<td>Realm of the resource</td>
</tr>
<tr><td>auth!users</td>
<td>List</td>
<td>List of allowed users</td>
</tr>
</tbody>
</table>
<p>So, here are a few examples about how this notation works:</p>
<ul>
<li><p class="first">The default virtual server uses the &quot;common&quot; handler as default
choice for its root directory:</p>
<pre class="literal-block">
vserver!default!directory!/!handler = common
vserver!default!directory!/!priority = 1
</pre>
</li>
<li><p class="first">The *.example.com and *.examples.org domains are restricted to be
accessed from the local loop interface, and have to be handled as a
FastCGI:</p>
<pre class="literal-block">
vserver!example!domains!1 = *.example.com
vserver!example!domains!2 = *.example.org
vserver!example!directory!/!handler = fcgi
vserver!example!directory!/!priority = 1
vserver!example!directory!/!allow_from = 127.0.0.1,::1
</pre>
</li>
<li><p class="first">ISO images should be handled as files and are protected by a
htdigest file using only Digest authentication:</p>
<pre class="literal-block">
vserver!default!extensions!iso,ISO!handler = file
vserver!default!extensions!iso,ISO!priority = 1
vserver!default!extensions!iso,ISO!auth = htdigest
vserver!default!extensions!iso,ISO!auth!realm = My secret isos
vserver!default!extensions!iso,ISO!auth!methods = digest
vserver!default!extensions!iso,ISO!auth!passwdfile = /var/passwd/isos.htdigest
</pre>
</li>
</ul>
</div>
<div class="section" id="logs">
<h1>Logs</h1>
<p>The log files are defined as properties inside the Virtual Server
hierarchy under a <tt class="docutils literal"><span class="pre">logger</span></tt> entry with the following properties:</p>
<table class="docutils">
<colgroup>
<col width="47%" />
<col width="9%" />
<col width="44%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Key</strong></td>
<td><strong>Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr><td>logger</td>
<td>String</td>
<td>Output format (validator name)</td>
</tr>
<tr><td>logger!access</td>
<td>Node</td>
<td>Defines the access log file</td>
</tr>
<tr><td>logger!error</td>
<td>Node</td>
<td>Defines the error log file</td>
</tr>
</tbody>
</table>
<p>and then, both access and error accept a number of parameters
depending on its property <tt class="docutils literal"><span class="pre">type</span></tt> which specifies where the logging
information will be written. It can be either:</p>
<table class="docutils">
<colgroup>
<col width="46%" />
<col width="54%" />
</colgroup>
<tbody valign="top">
<tr><td><strong>Logger writer Type</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr><td>file</td>
<td>Write a file</td>
</tr>
<tr><td>syslog</td>
<td>Use the system logging mechanism</td>
</tr>
<tr><td>stderr</td>
<td>Use the standard output</td>
</tr>
<tr><td>exec</td>
<td>Execute a program with each line</td>
</tr>
</tbody>
</table>
<p>If either <tt class="docutils literal"><span class="pre">file</span></tt> or <tt class="docutils literal"><span class="pre">exec</span></tt> is used, there is an additional
parameter that has to be set. In the case of file, a sub-property
named <tt class="docutils literal"><span class="pre">filename</span></tt> and for exec <tt class="docutils literal"><span class="pre">command</span></tt>.</p>
<p>Examples:</p>
<ul>
<li><p class="first">Apache format logs to the regular files:</p>
<pre class="literal-block">
vserver!default!logger = combined
vserver!default!logger!access!type = file
vserver!default!logger!access!filename = /var/log/cherokee.access.log
vserver!default!logger!error!type = file
vserver!default!logger!error!filename = /var/log/cherokee.error.log
</pre>
</li>
</ul>
</div>
<div class="section" id="inclusion-of-configuration">
<h1>Inclusion of Configuration</h1>
<p>Sometimes it is nice to break out your configuration into several logical files
to be more modular as well as more organized.  You can use the <tt class="docutils literal"><span class="pre">include</span></tt>
configuration to accomplish this.  Here is an example:</p>
<pre class="literal-block">
include = /etc/cherokee/advanced.conf
</pre>
<p>or even, it is possible to specify a directory to include all of its files:</p>
<pre class="literal-block">
include = /etc/cherokee/mods-enabled/
</pre>
</div>

    

    
</body>
</html>
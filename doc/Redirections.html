<html>
 <header>
     <title>Cherokee Web Server: Redirections</title>
	<style>	
	body {
		
		width: 760px; 
		margin: auto;
		font-family: 'Trebuchet MS', 'Lucida Grande', Verdana, Arial, Sans-Serif;
		font-size: small;
		padding: 10px;
	}
	
	#header {
		border-bottom: 2px solid #b00;
	}

	#toc {
		border: 
		color: #650;
		background-color: #f0e9b0;
		border: 1px solid #a99d3a;
		font-size: small;
		-moz-border-radius: 4px;
		float: right;
		margin: 4px;
	}

	#toc a {
		color: #650;
	}

	#toctitle {
		color: #fff;
		background-color: #650;
	}
	
	h1 {
		border-bottom: 1px solid #b00;
		float: right;
		border-bottom: 0px;
	}

	h2 {
		border-bottom: 1px solid #b00;
	}

	pre {
		background-color: #000;
		color: #ddd;
		padding: 5px;
	}

	#footer {
		border-top: 1px dotted #ddd;
		color: #666;
		font-size: 90%;
		padding: 10px;
		padding-bottom: 40px;
	}

/* Merge template style */

.messagebox {
   border: 1px solid #aaaaaa;
   background-color: #f9f9f9;
   width: 80%;
   margin: 0 auto 1em auto;
   padding: .2em;
   text-align: justify;
}
.messagebox.merge {
   border: 1px solid #cf9fff;
   background-color: #f5edf5;
   text-align: center;
}
.messagebox.cleanup {
   border: 1px solid #9f9fff;
   background-color: #efefff;
   text-align: center;
}
.messagebox.standard-talk {
   border: 1px solid #c0c090;
   background-color: #f8eaba;
}

	</style>
 </header>
 <body>
     <h1>Redirections</h1>
	<div id="header"><img src="cherokee.png" /></div>
	   <p>The main idea of a redirection is telling to the web client to go to another URL when the request URL matchs some rule. 
</p><p><br />
For example, if you have URLs like
</p>
<ul><li> http://example.com/inst/photogallery/viewphoto?photoid=1235
</li><li> http://example.com/inst/photogallery/viewcomments?photoid=1235
</li><li> http://example.com/inst/photogallery/admin?photoid=1235&amp;method=delete
</li></ul>
<p><br />
You probably would prefer URLs like:
</p>
<ul><li> http://example.com/photo/1235
</li><li> http://example.com/photo/1235/cmts
</li><li> http://example.com/photo/1235/delete
</li></ul>
<p><br />
</p>
<table id='toc' class='toc'><tr><td><div id='toctitle'><h2>Contents</h2></div>
<ul>
<li class='toclevel-1'><a href="#Parameters"><span class="tocnumber">1</span> <span class="toctext">Parameters</span></a></li>
<li class='toclevel-1'><a href="#Virtual_hosts_and_redirections"><span class="tocnumber">2</span> <span class="toctext">Virtual hosts and redirections</span></a></li>
<li class='toclevel-1'><a href="#Examples"><span class="tocnumber">3</span> <span class="toctext">Examples</span></a></li>
<li class='toclevel-1'><a href="#Short_path_requests"><span class="tocnumber">4</span> <span class="toctext">Short path requests</span></a></li>
</ul>
</td></tr></table>
<p><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
</p>
<a name="Parameters"></a><h2>Parameters</h2>
<p>The <b>redir</b> handler accepts three directives:
</p>
<ul><li> <b>Rewrite</b> "<i>regex</i>" "subs"<br />
</li></ul>
<p>This directive uses <a href="http://www.pcre.org" class='external text' title="http://www.pcre.org" rel="nofollow">PCRE</a> (Perl Compatible Regular Expressions) to make the substitution.  The redirection will happen internally, hence the the internal URL in which the address is translated will be invisible for the client.
</p>
<ul><li> <b>Show Rewrite</b> "<i>regex</i>" "subs"<br />
</li></ul>
<p>It works in the same way as the previous one, but in this case, it will redirect the connection to the new resource.
</p>
<ul><li> <b>URL</b> <i>url</i><br />
</li></ul>
<p>This specify the default rule which will be used if none of the previous Rewrite rules maches. It appends the requested URL to the end of <i>url</i>.
</p><p><br />
</p>
<a name="Virtual_hosts_and_redirections"></a><h2>Virtual hosts and redirections</h2>
<p>The internals redirections, using the <b>Rewrite</b> key word, are limited to work in the same virtual host. All the internal redirections will be processed in the original virtual host, which makes quite sense in terms of security.
</p><p>In the case you do need the redirect some resource to another virtual host and/or domain, you will have to use an explicit redirection using the <b>Show Rewrite</b> key words.
</p><p><br />
</p>
<a name="Examples"></a><h2>Examples</h2>
<p>This example will perform a hidden redirection:
</p>
<pre>Directory /photo {
    Handler redir {
        Rewrite &quot;/(\d+)$&quot; &quot;http://example.com/inst/photogallery/viewphoto?photoid=$1&quot;
        Rewrite &quot;/(\d+)/cmts&quot; &quot;http://example.com/viewcomments?photoid=$1&quot;
        Rewrite &quot;/(\d+)/delete&quot; &quot;http://example.com/inst/photogallery/admin?photoid=$1&amp;method=delete&quot;
        URL http://example.com/notfound?url=
    }
}</pre>
<p>Some examples of translations:
</p>
<table border="0" cellpadding="4">
<tr><td><b>Request</b></td><td><b>Internal translation</b></td></tr>
<tr><td>/photo/123</td><td>http://example.com/inst/photogallery/viewphoto?photoid=123</td></tr>
<tr><td>/photo/501/delete</td><td>http://example.com/inst/photogallery/admin?photoid=501&amp;method=delete</td></tr>
<tr><td>/photo/something</td><td>http://example.com/notfound?url=something </td></tr>
</table>
<p>It the request does not match on any of the <i>Rewirte</i> rules, it will use the default <i>URL</i> address to do the redirection.
</p><p><br />
</p><p>In the case you want to use an HTTP redirection, this is the right configuration entry:
</p>
<pre>Directory /photo {
    Handler redir {
        Show Rewrite &quot;/(\d+)$&quot; &quot;http://example.com/inst/photogallery/viewphoto?photoid=$1&quot;
        Show Rewrite &quot;/(\d+)/cmts&quot; &quot;http://example.com/viewcomments?photoid=$&quot;
        Show Rewrite &quot;/(\d+)/delete&quot; &quot;http://example.com/inst/photogallery/admin?photoid=$1&amp;method=delete&quot;
        URL http://example.com/notfound?url=
    }
}</pre>
<p><br />
In case you want to do a really simple redirection, you can use the <i>URL</i> tag as follows:
</p>
<pre>Directory /stats {
    Handler redir {
        URL http://example.com/cgi-bin/awstats.pl
    }
}</pre>
<p><br />
</p>
<a name="Short_path_requests"></a><h2>Short path requests</h2>
<p>There is a way to compact the Request entries that use a redir handler and a regular expression.  For example, lets imagine we want to rewrite a request like <i>/do/something</i> to <i>/index.php?action=something</i>, the default syntax is:
</p>
<pre>Request &quot;^/do/.*/?&quot; {
    Handler redir {
        Rewrite &quot;^/do/(.*)/?&quot; &quot;/index.php?action=$1&quot;
    }
}</pre>
<p>but it is also possible to use a short path request:
</p>
<pre>Request &quot;^/do/(.*)/?&quot; {
    Handler redir {
        Rewrite &quot;/index.php?action=$1&quot;
    }
}</pre>

     <div id="footer"><a href="http://www.0x50.org">Cherokee</a> Web Server</div>
 </body>
</html>
